---
import '../styles/global.css';
---

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact — Portfolio</title>
  </head>
  <body>
    <main class="min-h-screen w-full relative overflow-hidden">
      <!-- Background gradient exactement comme la maquette -->
      <div class="absolute inset-0" style="background: linear-gradient(135deg, #C39FE5 0%, #ffffff 100%);"></div>
      
      <!-- Home button top-left avec la flèche et Home exactement comme la maquette -->
      <a href="/" class="absolute top-8 left-8 z-30 hover:opacity-80 transition-opacity">
        <div class="flex items-center gap-1" style="color: #556b2f;">
          <svg width="40" height="40" viewBox="0 0 40 40" style="transform: rotate(180deg);">
            <path d="M15 10 L25 20 L15 30" stroke="#556b2f" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="title-font" style="font-size: 2.5rem; margin-left: -10px; color: #556b2f;">Home</span>
        </div>
      </a>
     

      <!-- Container principal -->
      <div class="absolute inset-0 flex items-center justify-between" style="padding: 0 8% 0 10%;">
        
          <!-- PARTIE GAUCHE : Titre, icônes, email et texte -->
          <div class="relative flex flex-col" style="gap: 1rem; max-width: 380px;">
            <!-- Cercle flou jaune en arrière-plan -->
            <div class="absolute" style="background: #FBCD0E; border-radius: 50%; filter: blur(70px); opacity: 0.6; width: 480px; height: 480px; top: 45%; left: 12%; transform: translate(-50%, -50%); z-index: 0;"></div>
            
            <!-- Titre Contacter-Moi -->
            <h1 class="title-font relative z-10" style="font-size: 4.2rem; color: #000000; line-height: 0.85; font-style: italic; margin-bottom: 0.5rem;">
              Contacter-Moi
            </h1>
            
            <!-- Icônes sociales -->
            <div class="relative z-10 flex" style="gap: 0.7rem;">
              <a href="https://www.behance.net/MaelieAddarioMa_d" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/behance.svg" alt="behance" style="width: 2.5rem; height: 2.5rem;" />
              </a>
              <a href="https://www.linkedin.com/in/maëlie-addario-b66790336" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/linkedin.svg" alt="linkedin" style="width: 2.5rem; height: 2.5rem;" />
              </a>
              <a href="https://www.instagram.com/ma_dart8" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/instagram.svg" alt="instagram" style="width: 2.5rem; height: 2.5rem;" />
              </a>
              <a href="https://fr.pinterest.com/Mamaeliea_d/" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/pinterest.svg" alt="pinterest" style="width: 2.5rem; height: 2.5rem;" />
              </a>
              <a href="https://linktr.ee/mamaeleea_d" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/linktree.svg" alt="linktree" style="width: 2.5rem; height: 2.5rem;" />
              </a>
            </div>

            <!-- Email souligné -->
            <a href="mailto:maelie@addario.fr" class="relative z-10 underline hover:opacity-70 transition-opacity" style="font-size: 0.95rem; color: #000000; font-family: 'Courier New', monospace; text-decoration-thickness: 2px; margin-top: 0.3rem;">
              maelie@addario.fr
            </a>

            <!-- Texte -->
            <div class="relative z-10" style="margin-top: 0.5rem;">
              <p style="color: #000000; font-size: 0.88rem; line-height: 1.5; max-width: 340px;">
                Je suis pratiquement partout. Alors, n'hésitez pas à choisir le mode de communication qui vous convient.
              </p>
            </div>
          </div>

          <!-- PARTIE DROITE : Formulaire -->
          <div class="relative" style="transform: rotate(-2.5deg);">
            
            <!-- Papier avec formulaire -->
            <div class="relative" style="width: 1000px; z-index: 2;">
              <img src="/formulaire-contact.webp" alt="papier formulaire" style="width: 100%; height: auto; display: block; transform: translateX(80px);" />
              
              <div class="absolute" style="top: 40%; left: 50%; transform: translate(-50%, -50%); width: 82%; max-width: 450px;">
                <!-- Titre du formulaire -->
                <h2 class="text-center title-font" style="font-size: 1.7rem; color: #000000; font-style: italic; margin-bottom: 1.5rem;">
                  Laissez un message rapide
                </h2>

                <!-- Formulaire -->
                <form id="contactForm" class="flex flex-col" style="gap: 1.2rem;">
                  <!-- Input Email -->
                  <input 
                    type="email" 
                    name="mail"
                    id="emailInput"
                    placeholder="Votre email" 
                    class="px-4 py-2.5 rounded-lg focus:outline-none"
                    style="border: 2px solid #c8a2e0; background: #f3e8ff; font-size: 0.95rem;"
                    required
                  />
                  
                  <!-- Textarea Message -->
                  <textarea 
                    name="Message"
                    id="messageInput"
                    placeholder="Message" 
                    rows="4"
                    class="px-4 py-2.5 rounded-lg focus:outline-none resize-none"
                    style="border: 2px solid #c8a2e0; background: #f3e8ff; font-size: 0.95rem;"
                    required
                  ></textarea>

                  <!-- Message de confirmation -->
                  <div id="statusMessage" class="hidden text-center px-4 py-2 rounded-lg"></div>

                  <!-- Texte et bouton avion -->
                  <div class="flex flex-col items-end" style="gap: 0.4rem; margin-top: 0.5rem;">
                    <p class="text-right title-font" style="font-size: 0.9rem; color: #000000; line-height: 1.2; font-style: italic;">
                      Pour envoyer votre message<br/>cliquer ici :
                    </p>
                    <button 
                      type="submit"
                      id="submitBtn"
                      class="hover:scale-110 transition-transform"
                    >
                      <img src="/avionpapier.webp" alt="send" style="width: 110px;" />
                    </button>
                  </div>
                </form>
              </div>
            </div>

          </div>
      </div>
    </main>

    <script>
      import pb from '../utils/pb';

      // Gestion du formulaire
      const form = document.getElementById('contactForm') as HTMLFormElement;
      const statusMessage = document.getElementById('statusMessage') as HTMLElement;
      const submitBtn = document.getElementById('submitBtn') as HTMLButtonElement;

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const emailInput = document.getElementById('emailInput') as HTMLInputElement;
        const messageInput = document.getElementById('messageInput') as HTMLTextAreaElement;

        const email = emailInput.value.trim();
        const message = messageInput.value.trim();

        if (!email || !message) {
          showMessage('Veuillez remplir tous les champs', 'error');
          return;
        }

        // Désactiver le bouton pendant l'envoi
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.5';

        try {
          console.log('Tentative d\'envoi vers PocketBase...');
          console.log('URL:', pb.baseUrl);
          console.log('Collection: Message');
          console.log('Données:', { mail: email, Message: message });

          // Essayer de créer directement sans authentification
          const record = await pb.collection('Message').create({
            mail: email,
            Message: message
          });

          console.log('✅ Message enregistré avec succès:', record);
          showMessage('Message envoyé avec succès ! ✈️', 'success');
          
          // Réinitialiser le formulaire
          form.reset();
        } catch (error: any) {
          console.error('❌ Erreur complète:', error);
          console.error('❌ Status:', error.status);
          console.error('❌ Response:', error.response);
          console.error('❌ Data:', error.data);
          
          // Message d'erreur plus détaillé
          let errorMsg = 'Erreur: ';
          if (error.status === 404) {
            errorMsg = 'Collection "Message" introuvable. Vérifiez le nom dans PocketBase.';
          } else if (error.status === 403) {
            errorMsg = 'Accès refusé. Vérifiez les règles API de la collection.';
          } else if (error.data) {
            errorMsg += JSON.stringify(error.data);
          } else {
            errorMsg += error.message || 'Erreur inconnue';
          }
          
          showMessage(errorMsg, 'error');
        } finally {
          // Réactiver le bouton
          submitBtn.disabled = false;
          submitBtn.style.opacity = '1';
        }
      });

      function showMessage(text: string, type: 'success' | 'error') {
        statusMessage.textContent = text;
        statusMessage.className = 'text-center px-4 py-2 rounded-lg text-sm';
        
        if (type === 'success') {
          statusMessage.style.background = '#d4edda';
          statusMessage.style.color = '#155724';
          statusMessage.style.border = '1px solid #c3e6cb';
        } else {
          statusMessage.style.background = '#f8d7da';
          statusMessage.style.color = '#721c24';
          statusMessage.style.border = '1px solid #f5c6cb';
        }
        
        statusMessage.classList.remove('hidden');

        // Masquer le message après 8 secondes pour laisser le temps de lire
        setTimeout(() => {
          statusMessage.classList.add('hidden');
        }, 8000);
      }
    </script>
  </body>
</html>
