---
import '../styles/global.css';
---

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/logo.svg" sizes="any" />
    <link rel="apple-touch-icon" href="/logo.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kapakana:wght@300..400&display=swap" rel="stylesheet">
    <title>Contact — Portfolio</title>
  </head>
  <body>
    <main class="min-h-screen w-full relative overflow-hidden">
      <!-- Background gradient exactement comme la maquette -->
      <div class="absolute inset-0" style="background: linear-gradient(135deg, #C39FE5 0%, #ffffff 100%);"></div>
      
      <!-- Home button top-left avec la flèche et Home exactement comme la maquette -->
      <a href="/" class="fixed top-4 md:top-8 left-4 md:left-8 z-30 hover:opacity-80 transition-opacity">
        <div class="flex items-center gap-1" style="color: #556b2f;">
          <svg width="32" height="32" viewBox="0 0 40 40" class="md:w-10 md:h-10" style="transform: rotate(180deg);">
            <path d="M15 10 L25 20 L15 30" stroke="#556b2f" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="title-font text-2xl md:text-3xl lg:text-4xl" style="margin-left: -10px; color: #556b2f;">Home</span>
        </div>
      </a>
     

      <!-- Container principal -->
      <div class="flex flex-col lg:flex-row items-center justify-center lg:justify-between gap-12 lg:gap-0 px-6 lg:px-[8%] py-12 lg:py-0 min-h-screen">
        
          <!-- PARTIE GAUCHE : Titre, icônes, email et texte -->
          <div class="relative flex flex-col gap-4 w-full lg:max-w-sm z-10">
            <div class="absolute hidden lg:block" style="background: #FBCD0E; border-radius: 50%; filter: blur(70px); opacity: 0.6; width: 480px; height: 480px; top: 45%; left: 12%; transform: translate(-50%, -50%); z-index: -1;"></div>
            
            <!-- Titre Contacter-Moi -->
            <h1 class="title-font relative z-10 text-5xl md:text-6xl lg:text-7xl text-black leading-tight italic mb-2">
              Contacter-Moi
            </h1>
            
            <!-- Icônes sociales -->
            <div class="relative z-10 flex gap-3">
              <a href="https://www.behance.net/MaelieAddarioMa_d" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/behance.svg" alt="behance" class="w-10 h-10" />
              </a>
              <a href="https://www.linkedin.com/in/maëlie-addario-b66790336" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/linkedin.svg" alt="linkedin" class="w-10 h-10" />
              </a>
              <a href="https://www.instagram.com/ma_dart8" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/instagram.svg" alt="instagram" class="w-10 h-10" />
              </a>
              <a href="https://fr.pinterest.com/Mamaeliea_d/" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/pinterest.svg" alt="pinterest" class="w-10 h-10" />
              </a>
              <a href="https://linktr.ee/mamaeleea_d" target="_blank" class="hover:scale-110 transition-transform">
                <img src="/linktree.svg" alt="linktree" class="w-10 h-10" />
              </a>
            </div>

            <!-- Email souligné -->
            <a href="mailto:maelie@addario.fr" class="relative z-10 underline hover:opacity-70 transition-opacity text-sm md:text-base text-black" style="font-family: 'Courier New', monospace; text-decoration-thickness: 2px; margin-top: 0.3rem;">
              maelie@addario.fr
            </a>

            <!-- Texte -->
            <div class="relative z-10 mt-2">
              <p class="text-black text-sm md:text-base leading-relaxed max-w-sm">
                Je suis pratiquement partout. Alors, n'hésitez pas à choisir le mode de communication qui vous convient.
              </p>
            </div>
          </div>

          <!-- PARTIE DROITE : Formulaire -->
          <div class="relative w-full lg:w-auto">
            
            <!-- Papier avec formulaire -->
            <div class="relative w-full max-w-2xl mx-auto lg:mx-0 z-10">
              <img src="/formulaire-contact.webp" alt="papier formulaire" class="w-full h-auto hidden md:block" />
              
              <div class="md:absolute static md:top-[40%] md:left-1/2 md:transform md:translate-x-[-50%] md:translate-y-[-50%] w-full md:w-[82%] max-w-md p-6 md:p-0">
                <!-- Titre du formulaire -->
                <h2 class="text-center title-font text-2xl md:text-3xl text-black italic mb-6">
                  Laissez un message rapide
                </h2>

                <!-- Formulaire -->
                <form id="contactForm" class="flex flex-col gap-5">
                  <!-- Input Email -->
                  <input 
                    type="email" 
                    name="mail"
                    id="emailInput"
                    placeholder="Votre email" 
                    class="px-4 py-2.5 rounded-lg focus:outline-none text-sm md:text-base"
                    style="border: 2px solid #c8a2e0; background: #f3e8ff;"
                    required
                  />
                  
                  <!-- Textarea Message -->
                  <textarea 
                    name="Message"
                    id="messageInput"
                    placeholder="Message" 
                    rows="4"
                    class="px-4 py-2.5 rounded-lg focus:outline-none resize-none text-sm md:text-base"
                    style="border: 2px solid #c8a2e0; background: #f3e8ff;"
                    required
                  ></textarea>

                  <!-- Message de confirmation -->
                  <div id="statusMessage" class="hidden text-center px-4 py-2 rounded-lg text-sm"></div>

                  <!-- Texte et bouton avion -->
                  <div class="flex flex-col items-end gap-2 mt-2">
                    <p class="text-right title-font text-sm md:text-base text-black leading-tight italic">
                      Pour envoyer votre message<br/>cliquer ici :
                    </p>
                    <button 
                      type="submit"
                      id="submitBtn"
                      class="hover:scale-110 transition-transform"
                    >
                      <img src="/avionpapier.webp" alt="send" class="w-20 md:w-28" />
                    </button>
                  </div>
                </form>
              </div>
            </div>

          </div>
      </div>
    </main>

    <script>
      import pb from '../utils/pb';

      // Gestion du formulaire
      const form = document.getElementById('contactForm') as HTMLFormElement;
      const statusMessage = document.getElementById('statusMessage') as HTMLElement;
      const submitBtn = document.getElementById('submitBtn') as HTMLButtonElement;

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const emailInput = document.getElementById('emailInput') as HTMLInputElement;
        const messageInput = document.getElementById('messageInput') as HTMLTextAreaElement;

        const email = emailInput.value.trim();
        const message = messageInput.value.trim();

        if (!email || !message) {
          showMessage('Veuillez remplir tous les champs', 'error');
          return;
        }

        // Désactiver le bouton pendant l'envoi
        submitBtn.disabled = true;
        submitBtn.style.opacity = '0.5';

        try {
          console.log('Tentative d\'envoi vers PocketBase...');
          console.log('URL:', pb.baseUrl);
          console.log('Collection: Message');
          console.log('Données:', { mail: email, Message: message });

          // Essayer de créer directement sans authentification
          const record = await pb.collection('Message').create({
            mail: email,
            Message: message
          });

          console.log('✅ Message enregistré avec succès:', record);
          showMessage('Message envoyé avec succès ! ✈️', 'success');
          
          // Réinitialiser le formulaire
          form.reset();
        } catch (error: any) {
          console.error('❌ Erreur complète:', error);
          console.error('❌ Status:', error.status);
          console.error('❌ Response:', error.response);
          console.error('❌ Data:', error.data);
          
          // Message d'erreur plus détaillé
          let errorMsg = 'Erreur: ';
          if (error.status === 404) {
            errorMsg = 'Collection "Message" introuvable. Vérifiez le nom dans PocketBase.';
          } else if (error.status === 403) {
            errorMsg = 'Accès refusé. Vérifiez les règles API de la collection.';
          } else if (error.data) {
            errorMsg += JSON.stringify(error.data);
          } else {
            errorMsg += error.message || 'Erreur inconnue';
          }
          
          showMessage(errorMsg, 'error');
        } finally {
          // Réactiver le bouton
          submitBtn.disabled = false;
          submitBtn.style.opacity = '1';
        }
      });

      function showMessage(text: string, type: 'success' | 'error') {
        statusMessage.textContent = text;
        statusMessage.className = 'text-center px-4 py-2 rounded-lg text-sm';
        
        if (type === 'success') {
          statusMessage.style.background = '#d4edda';
          statusMessage.style.color = '#155724';
          statusMessage.style.border = '1px solid #c3e6cb';
        } else {
          statusMessage.style.background = '#f8d7da';
          statusMessage.style.color = '#721c24';
          statusMessage.style.border = '1px solid #f5c6cb';
        }
        
        statusMessage.classList.remove('hidden');

        // Masquer le message après 8 secondes pour laisser le temps de lire
        setTimeout(() => {
          statusMessage.classList.add('hidden');
        }, 8000);
      }
    </script>
  </body>
</html>
