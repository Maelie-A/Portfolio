---
import '../../styles/global.css';
import pb from '../../utils/pb';

// R√©cup√©rer l'ID du projet depuis les params de l'URL
const { id } = Astro.params;

// R√©cup√©rer le projet depuis PocketBase
let projet: any = null;
let errorMessage = '';

try {
  if (id) {
    projet = await pb.collection('Projets').getOne(id);
    console.log('Projet r√©cup√©r√©:', projet?.Nom_projet);
  } else {
    errorMessage = 'ID du projet manquant';
  }
} catch (error: any) {
  console.error('Erreur lors de la r√©cup√©ration du projet:', error);
  errorMessage = error.message || 'Projet introuvable';
}

// Si le projet n'existe pas, rediriger ou afficher une erreur
if (!projet) {
  return Astro.redirect('/design-graphique');
}

// Fonction pour obtenir l'URL compl√®te d'une image
function getImageUrl(record: any, filename: string) {
  if (!filename) return '';
  return `${pb.baseUrl}/api/files/${record.collectionId}/${record.id}/${filename}`;
}

// R√©cup√©rer toutes les images de la galerie
const galerieImages = projet?.gallerie_images || [];
---

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{projet.Nom_projet} ‚Äî Portfolio</title>
    <style>
      /* Styles pour le contenu HTML des descriptions */
      .projet-content p {
        margin-bottom: 1.2rem;
      }
      .projet-content ul {
        list-style: disc;
        margin-left: 1.5rem;
        margin-bottom: 1.2rem;
      }
      .projet-content li {
        margin-bottom: 0.8rem;
        line-height: 1.8;
      }
      .projet-content strong {
        font-weight: 600;
        color: #000;
      }
      .projet-content em {
        font-style: italic;
      }
      .projet-content a {
        color: #8b5cf6;
        text-decoration: underline;
      }
      .projet-content a:hover {
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <main class="min-h-screen w-full relative overflow-hidden" style="background: linear-gradient(180deg, #f4bebe 0%, #f4d4d4 50%, #e8bebe 100%);">
      
      <!-- Bouton retour -->
      <a href="/design-graphique" class="absolute top-4 md:top-6 left-4 md:left-6 z-20 hover:opacity-80 transition-opacity">
        <div class="flex items-center gap-1" style="color: #000000;">
          <svg width="32" height="32" viewBox="0 0 40 40" class="md:w-10 md:h-10" style="transform: rotate(180deg);">
            <path d="M15 10 L25 20 L15 30" stroke="#000000" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="title-font text-2xl md:text-3xl lg:text-4xl" style="margin-left: -10px; color: #000000;">Retour</span>
        </div>
      </a>

      <!-- Contenu principal -->
      <div class="relative z-10 flex flex-col items-center py-16 px-4 md:px-8">
        
        <!-- Titre du projet -->
        <h1 class="title-font text-center mb-8 text-4xl md:text-5xl lg:text-6xl text-black italic">
          {projet.Nom_projet}
        </h1>

        <!-- Slogan si disponible -->
        {projet.Slogan && (
          <p class="text-center mb-12 text-lg md:text-xl lg:text-2xl italic max-w-3xl" style="color: #333;">
            "{projet.Slogan}"
          </p>
        )}

        <!-- Section avec CD ouvert et ferm√© -->
        <div class="flex flex-col md:flex-row gap-8 lg:gap-12 mb-12 items-center justify-center w-full max-w-4xl">
          {projet.cd_ferme && (
            <div class="flex flex-col items-center gap-3 w-full md:w-auto">
              <img 
                src={getImageUrl(projet, projet.cd_ferme)} 
                alt={`${projet.Nom_projet} - CD ferm√©`} 
                class="w-full max-w-xs md:max-w-sm h-auto object-cover rounded-lg shadow-lg"
              />
              <p class="text-base md:text-lg text-black">CD Ferm√©</p>
            </div>
          )}
          
          {projet.cd_ouvert && (
            <div class="flex flex-col items-center gap-3 w-full md:w-auto">
              <img 
                src={getImageUrl(projet, projet.cd_ouvert)} 
                alt={`${projet.Nom_projet} - CD ouvert`} 
                class="w-full max-w-xs md:max-w-sm h-auto object-cover rounded-lg shadow-lg"
              />
              <p class="text-base md:text-lg text-black">CD Ouvert</p>
            </div>
          )}
        </div>

        <!-- Description courte -->
        {projet.description_courte && (
          <div class="w-full max-w-4xl mb-8 bg-white bg-opacity-90 rounded-lg p-6 md:p-8 shadow-lg">
            <h2 class="title-font mb-4 text-2xl md:text-3xl text-black italic">
              Pr√©sentation
            </h2>
            <p class="text-sm md:text-base lg:text-lg leading-relaxed whitespace-pre-line" style="color: #444;">
              {projet.description_courte}
            </p>
          </div>
        )}

        <!-- Description compl√®te -->
        {projet.description_complete && (
          <div class="w-full max-w-4xl mb-12 bg-white bg-opacity-95 rounded-lg p-6 md:p-8 shadow-lg">
            <h2 class="title-font mb-6 text-2xl md:text-3xl text-black italic">
              D√©tails du projet
            </h2>
            <div class="projet-content text-sm md:text-base lg:text-lg leading-relaxed" style="color: #333;" set:html={projet.description_complete} />
          </div>
        )}

        <!-- Technologies utilis√©es -->
        {projet.Technologies && projet.Technologies.length > 0 && (
          <div class="w-full max-w-4xl mb-12 px-4">
            <h3 class="title-font text-center mb-6 text-2xl md:text-3xl text-black italic">
              Technologies utilis√©es
            </h3>
            <div class="flex flex-wrap gap-3 justify-center">
              {projet.Technologies.map((tech: string) => (
                <span class="px-4 md:px-6 py-2 bg-white bg-opacity-90 rounded-full shadow-md text-sm md:text-base" style="color: #333;">
                  {tech}
                </span>
              ))}
            </div>
          </div>
        )}

        <!-- Galerie d'images -->
        {galerieImages.length > 0 && (
          <div class="w-full max-w-5xl mb-12 px-4">
            <h3 class="title-font text-center mb-8 text-2xl md:text-3xl text-black italic">
              Galerie
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
              {galerieImages.map((image: string) => (
                <img 
                  src={getImageUrl(projet, image)} 
                  alt={`${projet.Nom_projet} - Image galerie`}
                  class="w-full h-48 md:h-64 object-cover rounded-lg shadow-md hover:scale-105 transition-transform cursor-pointer"
                />
              ))}
            </div>
          </div>
        )}

        <!-- Liens (Figma, Siteweb, etc.) -->
        {projet.Lien_figma_siteweb_autre && (
          <div class="mb-12 px-4">
            <a 
              href={projet.Lien_figma_siteweb_autre} 
              target="_blank"
              class="px-6 md:px-8 py-3 bg-white bg-opacity-90 rounded-full shadow-lg hover:scale-105 transition-transform inline-block text-sm md:text-base text-black"
              style="text-decoration: none;"
            >
              üîó Voir le projet en ligne
            </a>
          </div>
        )}

        <!-- Tag du projet -->
        {projet.tag && (
          <div class="mb-8 px-4">
            <span class="px-4 md:px-6 py-2 bg-purple-200 rounded-full text-xs md:text-sm" style="color: #666;">
              #{projet.tag}
            </span>
          </div>
        )}

      </div>

      <!-- Footer -->
      <footer class="relative z-20 py-12 px-8" style="background: linear-gradient(180deg, rgba(255, 255, 255, 0.9) 0%, #C39FE5 100%);">
        <div class="flex flex-col items-center gap-3">
          <!-- N≈ìud d√©coratif -->
          <img src="/noeud.webp" alt="n≈ìud" style="width: 240px; height: auto; opacity: 0.9;" />
          
          <!-- Citation -->
          <p class="title-font text-center" style="font-size: 2rem; color: #000000; font-style: italic; max-width: 650px; margin-bottom: 0.5rem;">
            "Une image vaut mille mots" Confucius
          </p>
          
          <!-- Ic√¥nes sociales -->
          <div class="flex gap-3 mb-2">
            <a href="mailto:maelie@addario.fr" class="hover:scale-110 transition-transform">
              <img src="/mail.svg" alt="email" style="width: 50px; height: 50px;" />
            </a>
            <a href="https://www.behance.net/MaelieAddarioMa_d" target="_blank" class="hover:scale-110 transition-transform">
              <img src="/behance.svg" alt="behance" style="width: 50px; height: 50px;" />
            </a>
            <a href="https://www.linkedin.com/in/ma√´lie-addario-b66790336" target="_blank" class="hover:scale-110 transition-transform">
              <img src="/linkedin.svg" alt="linkedin" style="width: 50px; height: 50px;" />
            </a>
            <a href="https://www.instagram.com/ma_dart8" target="_blank" class="hover:scale-110 transition-transform">
              <img src="/instagram.svg" alt="instagram" style="width: 50px; height: 50px;" />
            </a>
            <a href="https://fr.pinterest.com/Mamaeliea_d/" target="_blank" class="hover:scale-110 transition-transform">
              <img src="/pinterest.svg" alt="pinterest" style="width: 50px; height: 50px;" />
            </a>
            <a href="https://linktr.ee/mamaeleea_d" target="_blank" class="hover:scale-110 transition-transform">
              <img src="/linktree.svg" alt="linktree" style="width: 50px; height: 50px;" />
            </a>
          </div>
          
          <!-- Logo -->
          <img src="/logo.webp" alt="Maelie Addario logo" style="width: 150px; height: auto; margin-top: 0.3rem; margin-bottom: 0.3rem;" />
          
          <!-- Texte Portfolio -->
          <p style="font-size: 0.9rem; color: #000000;">
            Portfolio-Ma√´lie ADDARIO-2025
          </p>
          
          <!-- Liens mentions l√©gales et politique de confidentialit√© -->
          <div class="flex gap-4 mt-3">
            <a href="/mentions-legales" class="hover:underline transition-all" style="font-size: 0.8rem; color: #000000;">
              Mentions l√©gales
            </a>
            <span style="color: #000000;">‚Ä¢</span>
            <a href="/politique-confidentialite" class="hover:underline transition-all" style="font-size: 0.8rem; color: #000000;">
              Politique de confidentialit√©
            </a>
          </div>
        </div>
      </footer>
    </main>
  </body>
</html>
